import{S as N,i as Q,s as R,F as V,d as j,t as E,a as K,m as O,c as U,r as S,g as X,p as A,b as Y,e as Z,f as W,h as m,j as y,k as z,l as h,n as v,o as L,q as x,u as w,v as q,w as f,x as ee,y as J,z as C,A as D,B as te}from"./index-D49pSSYG.js";function ne(s){let t,u,o,n,e,p,_,d;return{c(){t=w("label"),u=D("邮箱"),n=q(),e=w("input"),f(t,"for",o=s[20]),f(e,"type","email"),f(e,"autocomplete","off"),f(e,"id",p=s[20]),e.disabled=s[7],e.required=!0},m(a,i){h(a,t,i),v(t,u),h(a,n,i),h(a,e,i),s[11](e),C(e,s[2]),_||(d=L(e,"input",s[12]),_=!0)},p(a,i){i&1048576&&o!==(o=a[20])&&f(t,"for",o),i&1048576&&p!==(p=a[20])&&f(e,"id",p),i&128&&(e.disabled=a[7]),i&4&&e.value!==a[2]&&C(e,a[2])},d(a){a&&(m(t),m(n),m(e)),s[11](null),_=!1,d()}}}function le(s){let t,u,o,n,e,p,_,d,a,i;return{c(){t=w("label"),u=D("密码"),n=q(),e=w("input"),_=q(),d=w("div"),d.textContent="建议至少10个字符。",f(t,"for",o=s[20]),f(e,"type","password"),f(e,"autocomplete","new-password"),f(e,"minlength","10"),f(e,"id",p=s[20]),e.disabled=s[7],e.required=!0,f(d,"class","help-block")},m(b,g){h(b,t,g),v(t,u),h(b,n,g),h(b,e,g),C(e,s[3]),h(b,_,g),h(b,d,g),a||(i=L(e,"input",s[13]),a=!0)},p(b,g){g&1048576&&o!==(o=b[20])&&f(t,"for",o),g&1048576&&p!==(p=b[20])&&f(e,"id",p),g&128&&(e.disabled=b[7]),g&8&&e.value!==b[3]&&C(e,b[3])},d(b){b&&(m(t),m(n),m(e),m(_),m(d)),a=!1,i()}}}function se(s){let t,u,o,n,e,p,_,d;return{c(){t=w("label"),u=D("确认密码"),n=q(),e=w("input"),f(t,"for",o=s[20]),f(e,"type","password"),f(e,"minlength","10"),f(e,"id",p=s[20]),e.disabled=s[7],e.required=!0},m(a,i){h(a,t,i),v(t,u),h(a,n,i),h(a,e,i),C(e,s[4]),_||(d=L(e,"input",s[14]),_=!0)},p(a,i){i&1048576&&o!==(o=a[20])&&f(t,"for",o),i&1048576&&p!==(p=a[20])&&f(e,"id",p),i&128&&(e.disabled=a[7]),i&16&&e.value!==a[4]&&C(e,a[4])},d(a){a&&(m(t),m(n),m(e)),_=!1,d()}}}function ie(s){let t,u,o,n,e,p,_,d,a,i,b,g,P,k,B,$,T,I,H;return n=new W({props:{class:"form-field required",name:"email",$$slots:{default:[ne,({uniqueId:l})=>({20:l}),({uniqueId:l})=>l?1048576:0]},$$scope:{ctx:s}}}),p=new W({props:{class:"form-field required",name:"password",$$slots:{default:[le,({uniqueId:l})=>({20:l}),({uniqueId:l})=>l?1048576:0]},$$scope:{ctx:s}}}),d=new W({props:{class:"form-field required",name:"passwordConfirm",$$slots:{default:[se,({uniqueId:l})=>({20:l}),({uniqueId:l})=>l?1048576:0]},$$scope:{ctx:s}}}),{c(){t=w("form"),u=w("div"),u.innerHTML="<h4>请创建您的第一个超级用户账户以继续</h4>",o=q(),U(n.$$.fragment),e=q(),U(p.$$.fragment),_=q(),U(d.$$.fragment),a=q(),i=w("button"),i.innerHTML='<span class="txt">创建超级用户并登录</span> <i class="ri-arrow-right-line"></i>',b=q(),g=w("hr"),P=q(),k=w("label"),k.innerHTML='<i class="ri-upload-cloud-line"></i> <span class="txt">或从备份初始化</span>',B=q(),$=w("input"),f(u,"class","content txt-center m-b-base"),f(i,"type","submit"),f(i,"class","btn btn-lg btn-block btn-next"),z(i,"btn-disabled",s[7]),z(i,"btn-loading",s[0]),f(t,"class","block"),f(t,"autocomplete","off"),f(k,"for","backupFileInput"),f(k,"class","btn btn-lg btn-hint btn-transparent btn-block"),z(k,"btn-disabled",s[7]),z(k,"btn-loading",s[1]),f($,"id","backupFileInput"),f($,"type","file"),f($,"class","hidden"),f($,"accept",".zip")},m(l,c){h(l,t,c),v(t,u),v(t,o),O(n,t,null),v(t,e),O(p,t,null),v(t,_),O(d,t,null),v(t,a),v(t,i),h(l,b,c),h(l,g,c),h(l,P,c),h(l,k,c),h(l,B,c),h(l,$,c),s[15]($),T=!0,I||(H=[L(t,"submit",x(s[8])),L($,"change",s[16])],I=!0)},p(l,c){const M={};c&3145892&&(M.$$scope={dirty:c,ctx:l}),n.$set(M);const r={};c&3145864&&(r.$$scope={dirty:c,ctx:l}),p.$set(r);const F={};c&3145872&&(F.$$scope={dirty:c,ctx:l}),d.$set(F),(!T||c&128)&&z(i,"btn-disabled",l[7]),(!T||c&1)&&z(i,"btn-loading",l[0]),(!T||c&128)&&z(k,"btn-disabled",l[7]),(!T||c&2)&&z(k,"btn-loading",l[1])},i(l){T||(K(n.$$.fragment,l),K(p.$$.fragment,l),K(d.$$.fragment,l),T=!0)},o(l){E(n.$$.fragment,l),E(p.$$.fragment,l),E(d.$$.fragment,l),T=!1},d(l){l&&(m(t),m(b),m(g),m(P),m(k),m(B),m($)),j(n),j(p),j(d),s[15](null),I=!1,y(H)}}}function ae(s){let t,u;return t=new V({props:{$$slots:{default:[ie]},$$scope:{ctx:s}}}),{c(){U(t.$$.fragment)},m(o,n){O(t,o,n),u=!0},p(o,[n]){const e={};n&2097407&&(e.$$scope={dirty:n,ctx:o}),t.$set(e)},i(o){u||(K(t.$$.fragment,o),u=!0)},o(o){E(t.$$.fragment,o),u=!1},d(o){j(t,o)}}}function ue(s,t,u){let o,{params:n}=t,e="",p="",_="",d=!1,a=!1,i,b;g();async function g(){if(!(n!=null&&n.token))return S("/");u(0,d=!0);try{const r=X(n==null?void 0:n.token);await A.collection("_superusers").getOne(r.id,{requestKey:"installer_token_check",headers:{Authorization:n==null?void 0:n.token}})}catch(r){r!=null&&r.isAbort||(Y("安装令牌无效或已过期。"),S("/"))}u(0,d=!1),await Z(),i==null||i.focus()}async function P(){if(!o){u(0,d=!0);try{await A.collection("_superusers").create({email:e,password:p,passwordConfirm:_},{headers:{Authorization:n==null?void 0:n.token}}),await A.collection("_superusers").authWithPassword(e,p),S("/")}catch(r){A.error(r)}u(0,d=!1)}}function k(){b&&u(6,b.value="",b)}function B(r){r&&ee(`注意：我们不会对上传的备份文件进行验证。请谨慎操作，仅在信任文件来源时继续。

您确定要上传并初始化"${r.name}"吗？`,()=>{$(r)},()=>{k()})}async function $(r){if(!(!r||o)){u(1,a=!0);try{await A.backups.upload({file:r},{headers:{Authorization:n==null?void 0:n.token}}),await A.backups.restore(r.name,{headers:{Authorization:n==null?void 0:n.token}}),te("正在解压上传的归档文件，请稍候！"),await new Promise(F=>setTimeout(F,2e3)),S("/")}catch(F){A.error(F)}k(),u(1,a=!1)}}function T(r){J[r?"unshift":"push"](()=>{i=r,u(5,i)})}function I(){e=this.value,u(2,e)}function H(){p=this.value,u(3,p)}function l(){_=this.value,u(4,_)}function c(r){J[r?"unshift":"push"](()=>{b=r,u(6,b)})}const M=r=>{var F,G;B((G=(F=r.target)==null?void 0:F.files)==null?void 0:G[0])};return s.$$set=r=>{"params"in r&&u(10,n=r.params)},s.$$.update=()=>{s.$$.dirty&3&&u(7,o=d||a)},[d,a,e,p,_,i,b,o,P,B,n,T,I,H,l,c,M]}class fe extends N{constructor(t){super(),Q(this,t,ue,ae,R,{params:10})}}export{fe as default};
